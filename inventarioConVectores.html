<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Productos</h1>
    <label for="name">Name</label> <br>
    <input type="text" id="name"> <br>
    <label for="code">Codigo</label> <br>
    <input type="number" id="code"> <br>
    <label for="costo">costo</label> <br>
    <input type="number" id="costo"> <br>
    <label for="cantidad">cantidad</label><br>
    <input type="number" id="cantidad"> <br>
    <label for="posicion">posicion **OPCIONAL***</label><br>
    <input type="number" id="posicion"> <br>
    <button class="bttn" id="add" >New Product</button> 
    <button id="list">List</button>
    <button id = "delete">Delete</button>
    <button id="search">Search</button>
    <button id="inverseList">Inverse List</button>
    <button id="insert">Insert</button>
    <button id="test">Test</button>
    <ul id="line"></ul>
    <script>
        class Producto{
            constructor(name,codigo, costo, cantidad){
                this.name= name;
                this.codigo = codigo;
                this.costo = costo;
                this.cantidad = cantidad;
            }
        }
        class Inventario {
            constructor(){
                this.productos= [];
            }
            addProducto(producto){
                let pos;
                let i = 0;
                let aux = {}, aux2 = {};
                let thisProductosLength = this.productos.length;
                if(thisProductosLength == 0){
                    this.productos[0] = producto;
                    return 1;
                }
                else if(thisProductosLength == 1){
                    if(this.productos[0].codigo <= producto.codigo ){
                        this.productos[1] = producto;
                        return 2;
                    }
                    else if(this.productos[0].codigo > producto.codigo){
                        this.productos[1] = this.productos[0];
                        this.productos[0] = producto;
                        return 3;
                    }
                    
                }
                else if( Math.abs(producto.codigo - this.productos[0].codigo) < Math.abs(producto.codigo - this.productos[this.productos.length - 1].codigo)){
                    while(pos == undefined){
                        if(this.productos[i].codigo < producto.codigo && this.productos[i + 1].codigo > producto.codigo){
                            pos = i;
                        }
                        else if(this.productos[i].codigo > producto.codigo && i == 0){
                            pos = i;
                        }
                        i++;
                    }
                    aux = this.productos[pos];
                    
                }
                else{
                    i = this.productos.length - 1;
                    if(producto.codigo > this.productos[i].codigo){
                        this.productos[i + 1] = producto;
                        return this.productos;
                    }
                    else{
                        while(pos == undefined){
                            if(producto.codigo < this.productos[i].codigo && producto.codigo > this.productos[i - 1].codigo){
                            pos = i;    
                            }
                            i--;
                        }
                        aux = this.productos[pos];
                    }
                }
                for(let i = pos; i < thisProductosLength; i++){
                    aux2 = this.productos[i + 1];
                    this.productos[i + 1] = aux;
                    aux = aux2;
                }
                this.productos[pos] = producto;
                return 5;
            }
            rankForBSearch(key){
                let lo = 0;
                let hi = this.productos.length - 1;
                let mid = 0;
                while(lo <= hi){
                    mid = Math.floor(lo + (hi - lo) / 2);
                    if(this.productos[mid].codigo > key){
                        hi = mid - 1;
                    }
                    else if(this.productos[mid].codigo < key){
                        lo = mid + 1;
                    }
                    else {
                        return mid;
                    }
                }
                return null;
            }
            binarySearch(code){
                let posicion = this.rankForBSearch(code);
                if(posicion == null)    return posicion;
                else                    return this.productos[posicion];
            }
            addToNIdProducto(producto,pos){
                pos--;
                if(!!this.productos[pos]){
                    for(let i = this.productos.length - 1; i >= pos; i--){
                        this.productos[i + 1] = this.productos[i];
                    }
                }
                this.productos[pos] = producto;
                
            }
            deleteProducto(code){
                    // let i = 0;
                    // let aux = 0;
                    // for (i in this.productos){
                    //     if (this.productos[i].codigo == code){
                    //     aux = 1; 
                    //     }else if(aux == 1){
                    //         this.productos[i - 1] = this.productos[i];
                    //     }
                    // }
                    // if(aux == 1){
                    //     this.productos.pop();
                    //     return true;
                    // }else{
                    //     return false;
                    // }
                    let aux =this.productos.length -1;
                    let aux2 ={};
                    if(this.rankForBSearch(code) == null){
                        return false;
                    }
                    else{
                        for(let i = this.productos.length - 1; i > this.rankForBSearch(code); i--){
                            aux2 = this.productos[i - 1];
                            this.productos[i - 1] = aux;
                            aux = aux2;
                        }
                        this.productos.pop();
                        return true;
                    }   
                
            }
            showProductos(){
                let line = "";
                for(i in this.productos){ //imprime todos los productos
                    if(!!this.productos[i]){
                        line += `<div class= "show"> <li>  <b> Id :</b> ${Number(i) + 1} <br>
                        <b>Nombre :</b>${this.productos[i].name} <br>
                        <b>Codigo :</b><a>${this.productos[i].codigo}</a> <br>
                        <b>Costo :</b>${this.productos[i].costo} <br>
                        <b>Cantidad :</b> ${this.productos[i].cantidad}
                        </li></div>`
                    }
                    else{
                        line += `<div class= "show"> <li>  <b> Id :</b> ${Number(i) + 1} <br>
                        <b>Nombre :</b>VACIO <br>
                        <b>Codigo :</b><a>VACIO</a> <br>
                        <b>Costo :</b>VACIO <br>
                        <b>Cantidad :</b> VACIO
                        </li></div>`
                    }
                }
                return line;
            }
            showProductoInverso(){
                let line = "";
                for(let i = this.productos.length - 1; i >= 0; i--){ //imprime todos los productos
                    if(!!this.productos[i]){
                        line += `<div class= "show"> <li>  <b> Id :</b> ${Number(i) + 1} <br>
                        <b>Nombre :</b>${this.productos[i].name} <br>
                        <b>Codigo :</b><a>${this.productos[i].codigo}</a> <br>
                        <b>Costo :</b>${this.productos[i].costo} <br>
                        <b>Cantidad :</b> ${this.productos[i].cantidad}
                        </li></div>`
                    }else{
                        line += `<div class= "show"> <li>  <b> Id :</b> ${Number(i) + 1} <br>
                        <b>Nombre :</b>VACIO <br>
                        <b>Codigo :</b><a>VACIO</a> <br>
                        <b>Costo :</b>VACIO <br>
                        <b>Cantidad :</b> VACIO
                        </li></div>` 
                    }
                }
                return line;
            }
            searchProducto(code){ 
                let aux = 1;
                let value;
                for (let i = 0; i < this.productos.length; i++) { //loopea todos los objetos y esconden los que no coinciden en la busqueda
                    if (this.productos[i].codigo == code) {
                        aux = 0;
                        value = this.productos[i]; //si se regresa un objeto en verdadero
                    } else if (aux == 1) {
                        value = null; //se regresa un null

                    }
                }
                return value;
            }

            
        }
        const inventario = new Inventario();
        load();
        let i = 0;
        // const btnTest = document.getElementById("test"); //ITS USED FOR TESTING
        // btnTest.addEventListener("click",()=>{
        //     let name = document.getElementById("name").value;
        //     let costo = document.getElementById("costo").value;
        //     let cantidad = document.getElementById("cantidad").value;
        //     let code = Number(document.getElementById("code").value);
        //     if(!!name && !!code && !!costo && !!cantidad ){ //introduce todos los valores importantes
        //             const producto = new Producto(name,code, costo, cantidad);
                    
        //             console.log(inventario.testAdd(producto))
                    
        //         }else{
        //             alert("Dato faltante"); //NO USAR ALERTS
        //         }
            
        // });
        const btnAdd = document.getElementById("add");
        btnAdd.addEventListener("click", ()=>{
            let name = document.getElementById("name").value;
            let costo = document.getElementById("costo").value;
            let cantidad = document.getElementById("cantidad").value;
            let code = Number(document.getElementById("code").value);
            if(!!name && !!code && !!costo && !!cantidad ){ //introduce todos los valores importantes
                    if(inventario.rankForBSearch(code) == null){
                        const producto = new Producto(name,code, costo, cantidad);
                        console.log(inventario.addProducto(producto));
                        save();
                    }else{
                        console.log("codigo ya existente");
                    }
                    
                }else{
                    console.log("Dato faltante"); //NO USAR ALERTS
                }
        })
        const btnList = document.getElementById("list");
        btnList.addEventListener("click",()=>{
            document.getElementById("line").innerHTML = inventario.showProductos();
        })
        const btnSearch = document.getElementById("search");
        btnSearch.addEventListener("click", ()=>{
            let code = document.getElementById("code").value;
            if(inventario.binarySearch(code) == null){
                console.log(`Producto con codigo "${code}" no existe`);
            }
            else console.log(inventario.binarySearch(code));
        });
        const btnDelete = document.getElementById("delete");
        btnDelete.addEventListener("click",()=>{
            let code = Number(document.getElementById("code").value);

            inventario.deleteProducto(code);
            save();
        });
        const btnInverseList = document.getElementById("inverseList");
        btnInverseList.addEventListener("click", ()=>{
            document.getElementById("line").innerHTML = inventario.showProductoInverso();
        });
        const btnInsert = document.getElementById("insert");
        btnInsert.addEventListener("click",()=>{
            let name = document.getElementById("name").value;
            let costo = document.getElementById("costo").value;
            let cantidad = document.getElementById("cantidad").value;
            let code = document.getElementById("code").value;
            let posicion = document.getElementById("posicion").value;
            if(!!name && !!code && !!costo && !!cantidad && !!posicion){ //introduce todos los valores importantes
                    const producto = new Producto(name,code, costo, cantidad);
                    inventario.addToNIdProducto(producto,posicion);
                    save();
                    
                }else{
                    alert("Dato faltante");
                }
        })
        
        function save(){
            localStorage.setItem("inventario.productos",JSON.stringify(inventario.productos));
        }
        function load(){
            if(!!localStorage.getItem("inventario.productos")){
                inventario.productos = JSON.parse(localStorage.getItem("inventario.productos"));
                
            }
                       
        }
    </script>
</body>
</html>





